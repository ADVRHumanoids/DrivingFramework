driving_path: &driving  /home/malgorzata/catkin_ws/src/
simulator_path: &simulator /home/malgorzata/catkin_ws/src/
config_path: &config /home/malgorzata/catkin_ws/src/DrivingFramework/configs/
support_path: &support /home/malgorzata/catkin_ws/src/DrivingFramework/configs/mwoibn/configs/support/

mwoibn:
        middleware: ROS
        system: SM # SM
        layers:
            RT:
                        path: *config
                        file: mwoibn/configs/support/RT.yaml
            NRT:
                        path: *config
                        file: mwoibn/configs/support/NRT.yaml
        robot:
                name: centauro
                systems:
                        HW:
                                path: *config
                                file: mwoibn/configs/support/hardware.yaml
                        SM:
                                path: *config
                                file: mwoibn/configs/support/simulation.yaml
                default:
                        feedback:
                                layer: online
                        actuators:
                                read: true
                        contacts:
                                read: true
                                feedback: true
                base_velocity:
                        feedback:
                                list: [link_side_online, simulation_base]
                        actuators:
                                read: true
                        contacts:
                                read: true
                                feedback: true
                force_test:
                        feedback:
                                list: [torque_reference, link_side_online, odometry]
                        actuators:
                                read: true
                        contacts:
                                read: true
                                feedback: false
                reference:
                        feedback:
                                list: [whole_body]
                        actuators:
                                read: false
                        contacts:
                                read: true
                                feedback: false
                odometry:
                        feedback:
                                list: [link_side_online, imu_base]
#                                list: [link_side_online, simulation_base]
                        actuators:
                                read: true
                        contacts:
                                read: true
                                feedback: false
                joint_space:
                        feedback:
                                list: [link_side_online] # , upper_body
                        actuators:
                                read: true
                        contacts:
                                read: false
                                feedback: false
                simulated:
                        feedback:
                                layer: simulated
                        actuators:
                                read: true
                        contacts:
                                read: true
                                feedback: false
                empty:
                        feedback:
                                layer:
                        actuators:
                                read: false
                        contacts:
                                read: false
                                feedback: false

        feedbacks:
                online: [link_side_online, odometry, upper_body]
                offline: [lower_body]
                simulated: [simulation_base, simulation_state]
        controllers:
                direct:
                        list: [position_controller, velocity_controller]
                position_reference:
                        list: [upper_body]
                torque_reference:
                        list: [torque_reference]
                empty:
                        list: []
                odometry:
                        list: [odometry]

        feedback:
                link_side_online:
                        space: JOINT
                        dofs:
                                chain: all
                                type: actuated
                                mapping: PYTHON
                        interface:
                                position: true
                                velocity: true
                                effort: true
                        limits:
                                tolerance:
                                        position: 5
                                        velocity: 0
                                        torque: 0
                        function: state
                simulation_state:
                        space: JOINT
                        dofs:
                                chain: all
                                type: actuated
                                mapping: PYTHON
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        function: state
                motor_side_online:
                floating_base:
                        space: OPERATIONAL
                        convention:
                                orientation:
                                        type: QUATERNION
                                        convention: HAMILTONIAN
                                position:
                                        type: FULL
                        dofs:
                                chain: all
                                type: body
                                name: pelvis
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: false
                                effort: false
                simulation_base:
                        space: OPERATIONAL
                        convention:
                                orientation:
                                        type: QUATERNION
                                        convention: HAMILTONIAN
                                position:
                                        type: FULL
                        dofs:
                                chain: all
                                type: body
                                name: pelvis
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        offset_orientation:
                                xx: -1
                                xy: 0
                                xz: 0
                                yx: 0
                                yy: 1
                                yz: 0
                                zx: 0
                                zy: 0
                                zz: -1
                        offset_position:
                                x: 0
                                y: 0
                                z: 0
                imu_base:
                        space: OPERATIONAL
                        convention:
                                orientation:
                                        type: QUATERNION
                                        convention: HAMILTONIAN
                                position:
                                        type: NONE
                        dofs:
                                chain: all
                                type: body
                                name: pelvis
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: false
                                effort: false
                        offset_orientation:
                                xx: -1
                                xy: 0
                                xz: 0
                                yx: 0
                                yy: 1
                                yz: 0
                                zx: 0
                                zy: 0
                                zz: -1
                        offset_position:
                                x: 0
                                y: 0
                                z: 0
                whole_body:
                        space: JOINT
                        dofs:
                                chain: all
                                type: all
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        function: state
                torque_reference:
                        space: JOINT
                        dofs:
                                chain: all
                                type: all
                                mapping: RBDL
                        interface:
                                position: false
                                velocity: false
                                effort: true
                        function: reference
                lower_body:
                        space: JOINT
                        dofs:
                                chain: lower_body
                                type: all
                                mapping: RBDL_LOWER #this has to be to indiacate the RBDL model that it is working with is only lower body
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        function: reference
                upper_body:
                        space: JOINT
                        dofs:
                                chain: upper_body
                                type: all
                                mapping: RBDL_UPPER #this has to be to indiacate the RBDL model that it is working with is only lower body
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        function: reference
                odometry:
                        space: JOINT
                        dofs:
                                chain: base
                                type: all
                                mapping: RBDL_LOWER #this has to be to indiacate the RBDL model that it is working with is only lower body
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        function: state
                velocity_reference:
                        space: JOINT
                        dofs:
                                chain: lower_body
                                type: all
                                mapping: RBDL_LOWER #this has to be to indiacate the RBDL model that it is working with is only lower body
                        interface:
                                position: false
                                velocity: true
                                effort: false
                        function: state
        controller:
                position_controller:
                        type: ""
                        dofs:
                                chain: position
                                type: actuated
                                mapping: PYTHON
                        interface:
                                position: true
                                velocity: false
                                effort:  true
                        initialize: link_side_online
                velocity_controller:
                        type: ""
                        dofs:
                                chain: wheels
                                type: actuated
                                mapping: PYTHON
                        interface:
                                position: false
                                velocity: true
                                effort: false
                whole_body:
                        type: reference
                        dofs:
                                chain: all
                                type: all
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: true
                                effort: false
                torque_reference:
                        type: reference
                        dofs:
                                chain: all
                                type: all
                                mapping: RBDL
                        interface:
                                position: false
                                velocity: false
                                effort: true
                lower_body:
                        type: reference
                        dofs:
                                chain: lower_body
                                type: all
                                mapping: PYTHON
                        interface:
                                position: true
                                velocity: true
                                effort: false
                upper_body:
                        type: reference
                        dofs:
                                chain: upper_body
                                type: all
                                mapping: RBDL
                        interface:
                                position: true
                                velocity: true
                                effort: false
                odometry:
                        type: reference
                        dofs:
                                chain: base
                                type: all
                                mapping: RBDL_LOWER #this he RBDL model that it is working with is only lower body
                        interface:
                                position: true
                                velocity: true
                                effort: false
                        filter:
                                run: false
                                frequency: 500.0
                                damping: 1.0
        ros:
                mapping:
                        PYTHON:
                                loading: topic
                                source: joint_states
                                message: sensor_msgs::JointState
                        RBDL_LOWER:
                                loading: model
                                urdf: /robot_lower_body
                        RBDL_UPPER:
                                loading: model
                                urdf: /robot_upper_body
                source:
                        urdf: /robot_control
                        #urdf: /robot_description
                        srdf: /robot_srdf
                        actuators: actuators_yaml
                        contacts: contacts_yaml
                feedback:
                        link_side_online:
                                source: joint_states
                                message: sensor_msgs::JointState
                                initialize: true
                        simulation_state:
                                source: joint_states
                                message: sensor_msgs::JointState
                                initialize: true
                        simulation_base:
                                source: /gazebo/link_states
                                message: gazebo_msgs::LinkStates
                                reference: centauro::pelvis
                                initialize: true
                        floating_base:
                                initialize: true
                        imu_base:
                                source: /gazebo/link_states
                                message: gazebo_msgs::LinkStates
                                reference: centauro::pelvis
                                initialize: true
                        whole_body:
                                source: desired_state
                                message: custom_messages::CustomCmnd
                                initialize: false
                        torque_reference:
                                source: desired_state
                                message: custom_messages::CustomCmnd
                                initialize: true
                        lower_body:
                                source: lower_body
                                message: custom_messages::CustomCmnd
                                initialize: false
                        upper_body:
                                source: upper_body
                                message: custom_messages::CustomCmnd
                                initialize: false
                        odometry:
                                source: base_odometry
                                message: custom_messages::CustomCmnd
                                initialize: true
                        velocity_reference:
                                source: desired_state
                                message: custom_messages::CustomCmnd
                                initialize: false
                        motor_side_online:
                                space: SKIP

                controller:
                        position_controller:
                                type: custom_controller/ActuatorPositionControllerClasses
                                sink: /command
                                ff_service: /set_ff_torque
                        velocity_controller:
                                type: custom_controller/ActuatorVelocityController
                                sink: /command
                        whole_body:
                                sink: desired_state
                        torque_reference:
                                sink: desired_state
                        lower_body:
                                sink: lower_body
                        upper_body:
                                sink: upper_body
                        odometry:
                                sink: base_odometry
        xbot:
                source:
                        config:
                                path: *config
                                file: xbot/higher/simulaton.yaml
                        urdf:
                                path: *config
                                file: mwoibn/urdf/centauro.urdf
                        srdf:
                                path: *config
                                file: mwoibn/srdf/centauro_full_wheels.srdf
                        actuators:
                                path: *config
                                file: mwoibn/configs/support/actuators.yaml
                        contacts:
                                path: *config
                                file: mwoibn/configs/support/contacts.yaml
                        controller:
                                path: *config
                                file:
                mapping:
                        RBDL_LOWER:
                                loading: model
                                urdf:
                                        path: *config
                                        file: mwoibn/urdf/centauro_lower_body.urdf
                        RBDL_UPPER:
                                loading: model
                                urdf:
                                        path: *config
                                        file: mwoibn/urdf/centauro_upper_body.urdf
                feedback:
                        link_side_online:
                                layer: online
                                dofs:
                                        mapping: XBOT
                        velocity_online:
                                layer: online
                                dofs:
                                        mapping: XBOT
                        motor_side_online:
                                layer: online
                                space: SKIP
                        floating_base:
                                layer: NRT
                                sensor: imu_link
                                source: floating_base
                        imu_base:
                                layer: online
                                sensor: imu_link
                                source: floating_base
                        whole_body:
                                layer: NRT
                                source: desired_state
                        upper_body:
                                layer: NRT
                                source: upper_body
                        torque_reference:
                                layer: NRT
                                source: desired_state
                        velocity_reference:
                                layer: NRT
                                source: desired_state
                        lower_body:
                                layer: NRT
                                source: desired_state
                        odometry:
                                layer: NRT
                                source: base_odometry
                controller:
                        position_controller:
                                layer: lower_level
                                dofs:
                                        mapping: XBOT
                        velocity_controller:
                                layer: lower_level
                                dofs:
                                        mapping: XBOT
                        whole_body:
                                layer: NRT
                                sink: desired_state
                        upper_body:
                                layer: NRT
                                sink: upper_body
                        torque_reference:
                                layer: NRT
                                sink: desired_state
                        lower_body:
                                layer: NRT
                                sink: desired_state
                        odometry:
                                layer: NRT
                                sink: base_odometry
        modules:
                joint_states:
                        layer: NRT
                        robot: joint_space
                        controller: direct
                        mode: full
                        kinematics: false
                        dynamics: false
                        model_change: false
                        chain: chains
                joint_lower:
                        layer: NRT
                        robot: joint_space
                        controller: direct
                        mode: full
                        kinematics: false
                        dynamics: false
                        model_change: false
                        chain: lower_body
                joint_reference:
                        layer: NRT
                        robot: default
                        controller: position_reference
                        secondary_file:
                            path: *support
                            file: upper_body.yaml
                        mode: full
                        kinematics: false
                        dynamics: false
                        model_change: false
                        chain: upper_body
                wheeled_motion:
                        layer: NRT
                        robot: default
                        # controller: position_reference
                        controller: direct
                        mode: full
                        kinematics: true
                        dynamics: true
                        model_change: false
                        chain: lower_body
                        secondary_file:
                            path: *support
                            file: lower_body.yaml
#                        tunning: ZMP_INDIRECT
                        steering: reactif
#                        position_gain: 200
                        tunning: disturb
#                        tunning: compliance
                        minor_axis: 0.068
                        major_axis: 0.01
                        track: wheels

                        reference_axis:
                                wheel_1:
                                  x: 0
                                  y: 0
                                  z: 1
                                wheel_2:
                                  x: 0
                                  y: 0
                                  z: -1
                                wheel_3:
                                  x: 0
                                  y: 0
                                  z: 1
                                wheel_4:
                                  x: 0
                                  y: 0
                                  z: -1
                                ankle2_1:
                                  x: 0
                                  y: 1
                                  z: 0
                                ankle2_3:
                                  x: 0
                                  y: 1
                                  z: 0
                                ankle2_2:
                                  x: 0
                                  y: -1
                                  z: 0
                                ankle2_4:
                                  x: 0
                                  y: -1
                                  z: 0
                        # IK: [qp::CONSTRAINTS, qp::BASE, qA::SUPPORT]
                        IK: [CONSTRAINTS, BASE, STEERING, CONTACT_POINTS, CAMBER, CASTER]
                        # IK: [qp::CONSTRAINTS, qp::BASE, qA::SUPPORT, qp::CASTER]
                        # IK: [qp::CONSTRAINTS, qp::BASE, qp::CONTACT_POINTS, qA::SUPPORT]
                        SUPPORT: [CASTER, CAMBER]
                        SHAPE: [SHAPE_JOINT]
                        steerings:
                                test:
                                        icm: 1.00 # 0.95
                                        sp: 0.01 # 0.05
                                        damp_icm: 0.0015
                                        damp_sp: 0.0025
                                        damp: 0.0015
                                        tracking: 1.0
                                open_loop:
                                        icm: 1.00
                                        sp:  0.1
                                        damp_icm: 0.0008
                                        damp_sp: 0.0015
                                        damp: 0.001
                                        tracking: 1.0
                                whole_body:
                                        icm: 1.00 # 0.95
                                        sp: 0.05 # 0.05
                                        damp_icm: 0.000000001 # 0.00001
                                        damp_sp: 0.0008
                                        damp: 0.00001
                                        tracking: 1.0
                                reactif:
                                        icm: 1.00 # 0.95
                                        sp: 0.05 # 0.05
                                        damp_icm: 0.0002 # 0.0002
                                        damp_sp: 0.0008
                                        damp: 0.0004
                                        tracking: 1.0
                        tunnings:
                                second_order: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.000001
                                        CONSTRAINTS: 1
                                        STEERING: 20 #50
                                        BASE: [0.10, 0.10, 4, 2, 2, 3]
                                        CONTACT_POINTS: 4
                                        CONTACT_POINTS_DAMP: 0.000005 #2?
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 4.0 # 4
                                        CASTER: 0.0 # 10
                                        CAMBER_DAMP: 0.000001 #0.04
                                        CASTER_DAMP: 0.000001
                                        COP: 0
                                compliance: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 0.5 #50
                                        BASE: [0.004, 0.004, 0.1, 0.5, 0.5, 0.5]
                                        CONTACT_POINTS: 0.5
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 0.1 # 4
                                        CASTER: 0.05 # 10
                                        CAMBER_DAMP: 0.08 #0.04
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                disturb: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 20 #50
                                        BASE: [0.10, 0.10, 4, 2, 2, 3]
                                        CONTACT_POINTS: 8
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 0.7 # 4
                                        CASTER: 1.5 # 10
                                        CAMBER_DAMP: 0.08 #0.04
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                reactif: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 20 #50
                                        BASE: [0.10, 0.10, 4, 2, 2, 3]
                                        CONTACT_POINTS: 4
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 0.7 # 4
                                        CASTER: 1.5 # 10
                                        CAMBER_DAMP: 0.08 #0.04
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                whole_body: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 20
                                        BASE: [3, 3, 3, 3, 3, 3]
                                        CONTACT_POINTS: 4
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 0.7 # 100
                                        CASTER: 1.5 # 14
                                        CAMBER_DAMP: 0.08
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                RT: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 90
                                        BASE: [100, 100, 100, 50, 50, 150]
                                        CONTACT_POINTS: 30
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 15 # 100
                                        CASTER: 30 # 14
                                        CAMBER_DAMP: 0.08
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                reactif_first_order: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 90
                                        BASE: [45, 45, 45, 20, 20, 80]
                                        CONTACT_POINTS: 30
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 15 # 100
                                        CASTER: 30 # 14
                                        CAMBER_DAMP: 0.08
                                        CASTER_DAMP: 0.12
                                        COP: 0
                                qp_reactif_first_order: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.000001
                                        CONSTRAINTS: 1
                                        STEERING: 30
                                        BASE: [45, 45, 45, 20, 20, 40]
                                        CONTACT_POINTS: 20
                                        CONTACT_POINTS_DAMP: 0.000002
                                        CAMBER: 10 # 100
                                        CASTER: 15 # 14
                                        CAMBER_DAMP: 0.000002
                                        CASTER_DAMP: 0.00000
                                        COP: 0
                                reactif_second_order: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 30
                                        BASE: [45, 45, 45, 20, 20, 30]
                                        CONTACT_POINTS: [15, 12, 15, 12, 15, 12, 15, 12]
                                        CONTACT_POINTS_DAMP: 0.000002
                                        CAMBER: 10 # 100
                                        CASTER: 5 # 14
                                        CAMBER_DAMP: 0.00000
                                        CASTER_DAMP: 0.00000
                                        COP: 0
                                odom_NRT_5: # circular - odom,
                                        ratio: 1.0
                                        damping: 0.0001
                                        CONSTRAINTS: 1
                                        STEERING: 90
                                        BASE: [45, 45, 45, 35, 35, 30]
                                        CONTACT_POINTS: 15
#                                        CONTACT_POINTS: 0.01
                                        CAMBER: 15 # 100
                                        CASTER: 30 # 14
                                        CAMBER_DAMP: 0.08
                                        CASTER_DAMP: 0.12
                                        COP: 0
                upper_body_ik:
                        layer: NRT
                        robot: default
                        controller: position_reference
                        secondary_file:
                            path: *support
                            file: upper_body.yaml
                        mode: full
                        kinematics: true
                        dynamics: true
                        model_change: false
                        chain: upper_body
                        tunning: disturb
                        track: manipulation
                        arm_base: arm_base
                        IK: [qp::ARMS]
                        tunnings:
                                disturb: # drive without caster - this should work only for zero camber angle (at least for now)
                                        ratio: 1.0
                                        damping: 0.0001
                                        ARMS: 0.5 #0.04

                odometry:
                        layer: NRT
                        robot: odometry
                        controller: odometry
                        secondary_file:
                            path: *support
                            file: odometry.yaml
#                        mode: full
                        mode: full
                        kinematics: true
                        dynamics: false
                        model_change: true
                        wheel_radius: 0.078
                        chain: wheels
                gravity_compensation:
                        layer: NRT
                        robot: default
                        controller: torque_reference
#                        secondary_file:
#                             path: *support
#                             file: lower_body.yaml
                        mode: full
                        kinematics: true
                        dynamics: false
                        model_change: false
                        track: wheels
                        # type: online
                        # reference: reference
                        # compliance: True
                compliance_compensation:
                        layer: NRT
                        robot: default
                        controller: direct
                        secondary_file:
                            path: *support
                            file: lower_body.yaml
                        mode: full
                        kinematics: true
                        dynamics: false
                        model_change: false
#                        type: online
#                        reference: reference
#                        compliance: True
                ground_forces:
                        layer: NRT
                        robot: default
                        controller: empty
                        mode: full
                        kinematics: true
                        dynamics: true
                        model_change: false
                        secondary_file:
                            path: *support
                            file: lower_body.yaml
                        contact_source:
                                path: *config
                                file: mwoibn/configs/support/contacts.yaml
                gravity_forces:
                        layer: NRT
                        robot: force_test
                        controller: empty
                        mode: full
                        kinematics: true
                        dynamics: false
                        model_change: false
                        secondary_file:
                            path: *support
                            file: torque.yaml
                        prefix: gravity_forces_
                        contact_source:
                                path: *support
                                file: contacts.yaml
                        filter:
                            torque:
                                damping: 1.0
                                cut_off_frequency: 200

                acceleration_test:
                        layer: NRT
                        robot: joint_space
                        controller: direct
                        mode: full
                        kinematics: true
                        dynamics: false
                        model_change: false
                shared:
                        layer: NRT
                        #plugins: [odometry, ground_forces, Nwheels3::wheeled_motion, gravity_compensation, ground_forces::gravity_forces]
                        # plugins: [odometry2::odometry, gravity_compensation]
                        #plugins: [joint_states::joint_reference, odometry2::odometry, ground_forces, gravity_compensation, NwheelsZMP::wheeled_motion, compliance_compensation]
                        # plugins: [joint_states::joint_reference, odometry2::odometry, ground_forces, NwheelsZMP::wheeled_motion]
#                        plugins: [joint_states::joint_reference, odometry3::odometry, gravity_compensation, ground_forces, NwheelsZMPII::wheeled_motion]
#                        plugins: [joint_states::joint_reference, odometry3::odometry, ground_forces, NwheelsZMPII::wheeled_motion]
                        # plugins: [UpperBodyIK::upper_body_ik, odometry3::odometry, ground_forces, gravity_compensation, NwheelsZMPII::wheeled_motion]
                        plugins: [UpperBodyIK::upper_body_ik, odometry3::odometry, gravity_compensation, ground_forces, NwheelsZMPII::wheeled_motion]
